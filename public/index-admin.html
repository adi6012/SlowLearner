<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SlowLearner â€” Admin Dashboard</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#fff; --primary:#7c3aed; --muted:#6b7280; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui; margin:0; background:var(--bg); color:#111}
    .app{display:flex;min-height:100vh}
    aside{width:250px;background:#fff;border-right:1px solid #e5e7eb;padding:20px}
    header.logo{font-weight:700;color:var(--primary);font-size:18px}
    nav{margin-top:20px}
    nav button{display:block;width:100%;padding:10px;border:0;background:transparent;text-align:left;border-radius:6px;cursor:pointer;margin-bottom:8px}
    nav button.active{background:rgba(124,58,237,0.1);color:var(--primary);font-weight:600}
    main{flex:1;padding:24px}
    .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.04);margin-bottom:16px}
    h2{margin-top:0}
    .user-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid #f3f4f6}
    .user-row:last-child{border-bottom:0}
    .btn{padding:6px 10px;border-radius:6px;border:0;cursor:pointer;font-size:13px}
    .btn.danger{background:var(--danger);color:#fff}
    .btn.primary{background:var(--primary);color:#fff}
    .btn.ghost{background:transparent;border:1px solid #ddd}
    .stats{display:flex;gap:20px}
    .stat{flex:1;text-align:center;background:#f9fafb;padding:12px;border-radius:8px}
    .stat h3{margin:0;font-size:20px}
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <header class="logo">Admin Dashboard</header>
      <nav>
        <button id="tab-overview" class="active">Overview</button>
        <button id="tab-users">Manage Users</button>
        <button id="tab-reports">Reports</button>
        <button id="tab-settings">Settings</button>
      </nav>
    </aside>

    <main>
      <!-- OVERVIEW -->
      <section id="panel-overview">
        <div class="stats">
          <div class="stat"><h3 id="stat-students">0</h3><div>Students</div></div>
          <div class="stat"><h3 id="stat-educators">0</h3><div>Educators</div></div>
          <div class="stat"><h3 id="stat-blocked">0</h3><div>Blocked Users</div></div>
        </div>
      </section>

      <!-- USERS -->
      <section id="panel-users" style="display:none">
        <div class="card">
          <h2>Manage Users</h2>
          <div id="users-list"></div>
        </div>
      </section>

      <!-- REPORTS -->
      <section id="panel-reports" style="display:none">
        <div class="card">
          <h2>Generate Reports</h2>
          <button class="btn primary" onclick="downloadReport('json')">Download JSON</button>
          <button class="btn ghost" onclick="downloadReport('csv')">Download CSV</button>
          <div id="report-preview" style="margin-top:14px;font-size:14px;color:var(--muted)">Preview will appear here...</div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="panel-settings" style="display:none">
        <div class="card">
          <h2>Settings</h2>
          <p>In a real app, this is where you configure system-wide settings, permissions, etc.</p>
        </div>
      </section>
    </main>
  </div>

  <script>
    const STORAGE_KEY = 'slowlearner_demo_v1';
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
    if(!db.students) db={students:[],materials:[],plans:[],educators:[]};

    // Tabs
    const tabs = {overview:'tab-overview',users:'tab-users',reports:'tab-reports',settings:'tab-settings'};
    const panels = {overview:'panel-overview',users:'panel-users',reports:'panel-reports',settings:'panel-settings'};
    Object.keys(tabs).forEach(k=>{
      document.getElementById(tabs[k]).addEventListener('click',()=>{
        Object.values(tabs).forEach(id=>document.getElementById(id).classList.remove('active'));
        Object.values(panels).forEach(id=>document.getElementById(id).style.display='none');
        document.getElementById(tabs[k]).classList.add('active');
        document.getElementById(panels[k]).style.display='block';
        renderAll();
      });
    });

    function renderAll(){
      renderStats();
      renderUsers();
    }

    function renderStats(){
      document.getElementById('stat-students').textContent=db.students.length;
      document.getElementById('stat-educators').textContent=db.educators?.length||0;
      const blocked = [...db.students,...(db.educators||[])].filter(u=>u.blocked).length;
      document.getElementById('stat-blocked').textContent=blocked;
    }

    function renderUsers(){
      const list=document.getElementById('users-list'); list.innerHTML='';
      const allUsers=[...db.students.map(s=>({...s,type:'student'})),...(db.educators||[]).map(e=>({...e,type:'educator'}))];
      if(allUsers.length===0){ list.innerHTML='<div style="color:var(--muted)">No users found</div>'; return; }
      allUsers.forEach(u=>{
        const row=document.createElement('div');
        row.className='user-row';
        row.innerHTML=`<div><strong>${u.name||'Unnamed'}</strong> <span style='color:var(--muted);font-size:13px'>(${u.type})</span></div>
          <div style='display:flex;gap:8px'>
            <button class='btn ${u.blocked?'primary':'danger'}' onclick='toggleBlock("${u.id}","${u.type}")'>${u.blocked?'Unblock':'Block'}</button>
          </div>`;
        list.appendChild(row);
      });
    }

    window.toggleBlock=function(id,type){
      let arr= type==='student'?db.students:db.educators;
      const u=arr.find(x=>x.id===id);
      if(u){u.blocked=!u.blocked;save();}
    }

    function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(db)); renderAll(); }

    // Reports
    window.downloadReport=function(format){
      const allUsers=[...db.students.map(s=>({...s,type:'student'})),...(db.educators||[]).map(e=>({...e,type:'educator'}))];
      if(format==='json'){
        const blob=new Blob([JSON.stringify(allUsers,null,2)],{type:'application/json'});
        const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='report.json'; a.click();
      } else if(format==='csv'){
        const header='id,name,type,blocked,progress';
        const rows=allUsers.map(u=>`${u.id},${u.name},${u.type},${u.blocked||false},${u.progress||''}`);
        const csv=[header,...rows].join('\n');
        const blob=new Blob([csv],{type:'text/csv'});
        const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='report.csv'; a.click();
      }
      document.getElementById('report-preview').textContent='Report generated with '+allUsers.length+' records.';
    }

    // Initial demo data seed if empty
    function uid(prefix='id'){return prefix+'_'+Math.random().toString(36).slice(2,9)}
    if(db.students.length===0){ db.students.push({id:uid('stu'),name:'Demo Student',progress:50}); }
    if(!db.educators||db.educators.length===0){ db.educators=[{id:uid('edu'),name:'Educator A'}]; }
    save();

  </script>
</body>
</html>
